{% extends 'admin.html.twig' %}
{% set route = app.request.attributes.get('_route') %}
{% block title %}{{ title }}{% endblock %}

{% block body %}
<div class="admin-page-header">
    <div class="header-content">
        <h1>{{ title }}</h1>
        <p class="page-subtitle">{{ description }}</p>
    </div>
</div>

<div class="admin-table-card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="admin-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>telegram_id</th>
                    <th>username</th>
                    <th>Имя</th>
                    <th>Категория</th>
                    <th>Задача</th>
                    <th>Телефон</th>
                    <th>Статус</th>
                    <th>Действия</th>
                </tr>
                </thead>

                <tbody>
                {% for order in orders %}
                    <tr data-id="{{ order.id }}">
                        <td class="entity-id">#{{ order.id }}</td>
                        <td>{{ order.userId }}</td>
                        <td>{{ order.username ?: '-' }}</td>
                        <td>{{ [order.userFirstName, order.userLastName]|filter(v => v is not empty)|join(' ') ?: '-' }}</td>
                        <td>{{ order.category }}</td>
                        <td>{{ order.task }}</td>
                        <td>{{ order.phone }}</td>
                        <td>
                            <form method="post" action="{{ path('admin_bot_orders_change_status', {'id': order.id}) }}" class="d-flex gap-2 align-items-center">
                                <input type="hidden" name="_token" value="{{ csrf_token('status' ~ order.id) }}">
                                <select name="status" class="form-select form-select-sm">
                                    <option value="new" {{ order.status == 'new' ? 'selected' : '' }}>Новый</option>
                                    <option value="in_progress" {{ order.status == 'in_progress' ? 'selected' : '' }}>В работе</option>
                                    <option value="done" {{ order.status == 'done' ? 'selected' : '' }}>Выполнен</option>
                                </select>
                                <button class="btn btn-sm btn-primary" type="submit">OK</button>
                            </form>
                        </td>
                        <td>
                            <form method="post" action="{{ path('admin_bot_orders_delete', {'id': order.id}) }}" onsubmit="return confirm('Удалить заказ #{{ order.id }}?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ order.id) }}">
                                <button class="btn btn-sm btn-outline-danger" type="submit">Удалить</button>
                            </form>
                        </td>
                    </tr>
                {% else %}
                    <tr class="empty-row">
                        <td colspan="9">
                            <p class="empty-text">Заказов с телеграмма пока нет</p>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
